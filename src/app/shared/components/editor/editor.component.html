<div *ngIf="selectedFunnelId">
  <mat-toolbar>
    <mat-toolbar-row>
      <app-name-editor (changes)="renameFunnel(selectedFunnelId,$event)" [name]="funnels[selectedFunnelId]?.name">
      </app-name-editor>
    </mat-toolbar-row>
    <mat-toolbar-row>
    </mat-toolbar-row>
  </mat-toolbar>

  <ng-scrollbar class="pages-wrapper">
    <mat-list *ngIf="pages">
      <div [id]="pageId" [class.selected]="selectedPageId === pages[pageId].id" matRipple
        (click)="selectPage(pages[pageId].id)" class="list-entry" mat-list-item #listItem
        *ngFor="let pageId of funnels[selectedFunnelId]?.pageIds; let pageIdx = index">
        <span class="num">{{pageIdx+1}}</span>

        <app-name-editor class="list-entry-editor" (changes)="renamePage(pages[pageId].id,$event)"
          [name]="pages[pageId]?.name"></app-name-editor>
      </div>
    </mat-list>
  </ng-scrollbar>
  <div class="page-wrapper">
    <app-page #pageContainer [cdkDropListData]="displayedBlocks" cdkDropList [cdkDropListSortPredicate]="enterPredicate"
      (cdkDropListDropped)="drop($event)" cdkDropListclass="app-page" [editable]="true" *ngIf="selectedPageId"
      [zoom]="1" [page]="pages[selectedPageId]">
      <ng-container *ngFor="let blockId of pages[selectedPageId]?.blockIds">
        <div #container (cdkDragStarted)="dragStart(container,blockId)" (cdkDragEnded)="dragEnd(container,blockId)"
          [cdkDragLockAxis]="'y'" [cdkDragData]="blockId" cdkDrag>
          <app-block (selected)="activateWidget(undefined,blockRef.elementRef,blockId)" #blockRef [height]="blockId === selectedBlockId ? curDragHeight:0"
            [class.activated]="blockId === selectedBlockId" [item]="blocks[blockId]">
            <ng-template #widgetTemplate let-widgetId>
              <app-widget (cdkDragEnded)="dragExited($event,widgetId)" cdkDrag (cdkDragMoved)="dragMove($event)"
                (click)="activateWidget($event,blockRef.elementRef,blockId,widgetId)" [slot]="widgetId"
                [class.activated]="widgetId === selectedWidgetId" [widget]="widgets[widgetId]">
              </app-widget>
            </ng-template>
          </app-block>

          <div *ngIf="blockId === selectedBlockId" [cdkDragData]="null" (cdkDragEnded)="resize($event,blockId)"
            (cdkDragMoved)="onResize($event,blockId)" cdkDragBoundary=".widget" [cdkDragLockAxis]="'y'" cdkDrag
            class="drag-border">
            <span class="handle-circle mat-elevation-z4" cdkDragHandle></span>
          </div>

        </div>
      </ng-container>
    </app-page>
    <div class="actions">
      <button mat-button (click)="createBlock()">
        <mat-icon>add</mat-icon> {{'BUTTON.create_value'|translate:{value:'LABEL.block'|translate} }}
      </button>
    </div>
  </div>

  <button mat-fab (click)="createPage()" color="primary" class="fab"
    aria-label="Example icon button with a delete icon">
    <mat-icon>more_vert</mat-icon>
  </button>
  <button mat-button (click)="demo()" color="primary" class="fab" aria-label="Example icon button with a delete icon">
    <mat-icon>more_vert</mat-icon>View
  </button>

</div>
