<ng-container *ngIf="selectedFunnelId">
  <mat-toolbar>
    <mat-toolbar-row>
      <button mat-icon-button (click)="home()">
        <mat-icon>home</mat-icon>
      </button>
      <app-name-editor (changes)="renameFunnel(selectedFunnelId,$event)" [name]="funnels[selectedFunnelId]?.name">
      </app-name-editor>
      <span class="spacer"></span>
      <button mat-icon-button (click)="demo()">
        <mat-icon>visibility</mat-icon>
      </button>

    </mat-toolbar-row>
  </mat-toolbar>

  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav #drawer class="sidenav" [opened]="true" [mode]="'side'">
      <mat-tab-group>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">auto_stories</mat-icon>
            Seiten
          </ng-template>
          <ng-template matTabContent>
            <ng-scrollbar class="pages-wrapper">
              <mat-list *ngIf="pages">
                <div [id]="pageId" [class.selected]="selectedPageId === pages[pageId].id" matRipple
                  (click)="selectPage(pages[pageId].id)" class="list-entry" mat-list-item #listItem
                  *ngFor="let pageId of funnels[selectedFunnelId]?.pageIds; let pageIdx = index">
                  <span class="num">{{pageIdx+1}}</span>

                  <app-name-editor class="list-entry-editor" (changes)="renamePage(pages[pageId].id,$event)"
                    [name]="pages[pageId]?.name"></app-name-editor>
                </div>
              </mat-list>
            </ng-scrollbar>
            <button (click)="createPage()" class="add-btn" mat-button>
              <mat-icon>add</mat-icon> Erstellen
            </button>
          </ng-template>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">palette</mat-icon>
            Design
          </ng-template>
          <ng-template matTabContent>
            <app-ctx></app-ctx>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </mat-sidenav>
    <mat-sidenav-content class="bg">
      <div class="page-wrapper" [style.zoom]="'100%'">
        <app-page #pageContainer [cdkDropListData]="displayedBlocks" cdkDropList
          [cdkDropListSortPredicate]="enterPredicate" (cdkDropListDropped)="drop($event)" cdkDropListclass="app-page"
          [editable]="true" *ngIf="selectedPageId" [zoom]="1" [page]="pages[selectedPageId]">
          <ng-container *ngFor="let blockId of pages[selectedPageId]?.blockIds">
            <div #container (cdkDragStarted)="dragStart(container,blockId)" (cdkDragEnded)="dragEnd(container,blockId)"
              [cdkDragLockAxis]="'y'" [cdkDragData]="blockId" cdkDrag>
              <app-block (selected)="activateWidget(undefined,blockRef.elementRef,blockId)" #blockRef
                [height]="blockId === selectedBlockId ? curDragHeight:0"
                [class.activated]="blockId === selectedBlockId && blockIsActive" [item]="blocks[blockId]">
                <ng-template #widgetTemplate let-widgetId>
                  <app-widget (cdkDragEnded)="dragExited($event,widgetId)" cdkDrag (cdkDragMoved)="dragMove($event)"
                    (click)="activateWidget($event,blockRef.elementRef,blockId,widgetId)" [slot]="widgetId"
                    [class.activated]="widgetId === selectedWidgetId" [widget]="widgets[widgetId]">
                  </app-widget>
                </ng-template>
              </app-block>

              <div *ngIf="blockId === selectedBlockId" [cdkDragData]="null" (cdkDragEnded)="resize($event,blockId)"
                (cdkDragMoved)="onResize($event,blockId)" cdkDragBoundary=".widget" [cdkDragLockAxis]="'y'" cdkDrag
                class="drag-border">
                <span class="handle-circle mat-elevation-z4" cdkDragHandle></span>
              </div>

            </div>
          </ng-container>
        </app-page>
        <div class="actions">
          <button mat-button (click)="createBlock()">
            <mat-icon>add</mat-icon> {{'BUTTON.create_value'|translate:{value:'LABEL.block'|translate} }}
          </button>
        </div>
      </div>


    </mat-sidenav-content>
  </mat-sidenav-container>






</ng-container>
